"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator.throw(value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments)).next());
    });
};
const sass = require('node-sass');
const tmp = require('tmp');
const fs = require('fs');
const pathUtils = require('path');
const program = require('commander');
const chokidar = require('chokidar');
const TsTypeInfo = require('ts-type-info');
//  import styles from './test/test.scss'; 
//  styles.
let DtsCreator = require('typed-css-modules');
let find = require('find');
function getDestFileName(filename) {
    return filename + '.d.ts';
}
function processFile(filename) {
    return __awaiter(this, void 0, void 0, function* () {
        let tmpFile = tmp.fileSync();
        let destFileName = getDestFileName(filename);
        console.log(`Parsing file ${filename} to ${destFileName}`);
        try {
            let parsed = sass.renderSync({ file: filename, outFile: tmpFile.name });
            let css = (new Buffer(parsed.css)).toString();
            fs.writeFileSync(tmpFile.name, css);
            let cssToDtsConverter = new DtsCreator();
            let content = yield cssToDtsConverter.create(tmpFile.name);
            let tokens = content.rawTokenList;
            let typings = TsTypeInfo.createFile();
            typings.addClasses({
                name: 'Styles',
                isExported: true,
                isDefaultExportOfFile: true,
                isAmbient: true,
                isNamedExportOfFile: true,
                hasDeclareKeyword: true,
                properties: tokens.map(token => ({ name: `'${token}'`, type: 'string' })),
                onAfterWrite: writer => {
                    writer.writeLine(``);
                    writer.writeLine(`export declare var style: Styles;`);
                }
            });
            fs.writeFileSync(destFileName, typings.write());
        }
        catch (e) {
            console.error(e);
            throw e;
        }
        finally {
            tmpFile.removeCallback();
        }
    });
}
program
    .version('1.0.0')
    .option('-d, --dir [root]', 'set root directory')
    .option('-m, --match [regex]', 'set files regex', '^[^_].+\\.scss$')
    .option('-w, --watch', 'watch mode')
    .parse(process.argv);
let workingDirectory = pathUtils.join(process.cwd(), program['dir'] || '');
let match = new RegExp(program['match']);
let files = find.fileSync(match, workingDirectory);
files.reduce((previous, current) => previous.then(() => processFile(current)).catch(e => { }), Promise.resolve())
    .then(() => {
    console.log('completed');
})
    .catch(e => {
    console.error(e);
    throw e;
})
    .then(() => {
    if (program['watch']) {
        let watcher = chokidar.watch('*', { cwd: workingDirectory });
        watcher
            .on('add', path => {
            if (match.test(path)) {
                processFile(pathUtils.join(workingDirectory, path));
            }
        })
            .on('change', path => {
            if (match.test(path)) {
                processFile(pathUtils.join(workingDirectory, path));
            }
        })
            .on('unlink', path => {
            if (match.test(path)) {
                let destFileName = getDestFileName(pathUtils.join(workingDirectory, path));
                if (fs.existsSync(destFileName)) {
                    fs.unlinkSync(destFileName);
                }
            }
        });
        let watched = watcher.getWatched();
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9pbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQSxNQUFZLElBQUksV0FBTSxXQUFXLENBQUMsQ0FBQTtBQUNsQyxNQUFZLEdBQUcsV0FBTSxLQUFLLENBQUMsQ0FBQTtBQUMzQixNQUFZLEVBQUUsV0FBTSxJQUFJLENBQUMsQ0FBQTtBQUN6QixNQUFZLFNBQVMsV0FBTSxNQUFNLENBQUMsQ0FBQTtBQUNsQyxNQUFZLE9BQU8sV0FBTSxXQUFXLENBQUMsQ0FBQTtBQUNyQyxNQUFZLFFBQVEsV0FBTSxVQUFVLENBQUMsQ0FBQTtBQUNyQyxNQUFZLFVBQVUsV0FBTSxjQUFjLENBQUMsQ0FBQTtBQUUzQywyQ0FBMkM7QUFFM0MsV0FBVztBQUVYLElBQUksVUFBVSxHQUFHLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO0FBQzlDLElBQUksSUFBSSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUUzQix5QkFBeUIsUUFBZ0I7SUFDckMsTUFBTSxDQUFDLFFBQVEsR0FBRyxPQUFPLENBQUM7QUFDOUIsQ0FBQztBQUVELHFCQUEyQixRQUFnQjs7UUFDdkMsSUFBSSxPQUFPLEdBQUcsR0FBRyxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQzdCLElBQUksWUFBWSxHQUFHLGVBQWUsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUU3QyxPQUFPLENBQUMsR0FBRyxDQUFDLGdCQUFnQixRQUFRLE9BQU8sWUFBWSxFQUFFLENBQUMsQ0FBQztRQUUzRCxJQUFJLENBQUM7WUFDRCxJQUFJLE1BQU0sR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxPQUFPLEVBQUUsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7WUFDeEUsSUFBSSxHQUFHLEdBQUcsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMs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bnRlbnQiOlsiaW1wb3J0ICogYXMgc2FzcyBmcm9tICdub2RlLXNhc3MnO1xyXG5pbXBvcnQgKiBhcyB0bXAgZnJvbSAndG1wJztcclxuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xyXG5pbXBvcnQgKiBhcyBwYXRoVXRpbHMgZnJvbSAncGF0aCc7XHJcbmltcG9ydCAqIGFzIHByb2dyYW0gZnJvbSAnY29tbWFuZGVyJztcclxuaW1wb3J0ICogYXMgY2hva2lkYXIgZnJvbSAnY2hva2lkYXInO1xyXG5pbXBvcnQgKiBhcyBUc1R5cGVJbmZvIGZyb20gJ3RzLXR5cGUtaW5mbyc7XHJcblxyXG4vLyAgaW1wb3J0IHN0eWxlcyBmcm9tICcuL3Rlc3QvdGVzdC5zY3NzJzsgXHJcblxyXG4vLyAgc3R5bGVzLlxyXG5cclxubGV0IER0c0NyZWF0b3IgPSByZXF1aXJlKCd0eXBlZC1jc3MtbW9kdWxlcycpO1xyXG5sZXQgZmluZCA9IHJlcXVpcmUoJ2ZpbmQnKTtcclxuXHJcbmZ1bmN0aW9uIGdldERlc3RGaWxlTmFtZShmaWxlbmFtZTogc3RyaW5nKSB7XHJcbiAgICByZXR1cm4gZmlsZW5hbWUgKyAnLmQudHMnO1xyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiBwcm9jZXNzRmlsZShmaWxlbmFtZTogc3RyaW5nKSB7XHJcbiAgICBsZXQgdG1wRmlsZSA9IHRtcC5maWxlU3luYygpO1xyXG4gICAgbGV0IGRlc3RGaWxlTmFtZSA9IGdldERlc3RGaWxlTmFtZShmaWxlbmFtZSk7XHJcblxyXG4gICAgY29uc29sZS5sb2coYFBhcnNpbmcgZmlsZSAke2ZpbGVuYW1lfSB0byAke2Rlc3RGaWxlTmFtZX1gKTtcclxuXHJcbiAgICB0cnkge1xyXG4gICAgICAgIGxldCBwYXJzZWQgPSBzYXNzLnJlbmRlclN5bmMoeyBmaWxlOiBmaWxlbmFtZSwgb3V0RmlsZTogdG1wRmlsZS5uYW1lIH0pO1xyXG4gICAgICAgIGxldCBjc3MgPSAobmV3IEJ1ZmZlcihwYXJzZWQuY3NzKSkudG9TdHJpbmcoKTtcclxuICAgICAgICBmcy53cml0ZUZpbGVTeW5jKHRtcEZpbGUubmFtZSwgY3NzKTtcclxuICAgICAgICBsZXQgY3NzVG9EdHNDb252ZXJ0ZXIgPSBuZXcgRHRzQ3JlYXRvcigpO1xyXG4gICAgICAgIGxldCBjb250ZW50ID0gYXdhaXQgY3NzVG9EdHNDb252ZXJ0ZXIuY3JlYXRlKHRtcEZpbGUubmFtZSk7XHJcbiAgICAgICAgbGV0IHRva2VucyA9IGNvbnRlbnQucmF3VG9rZW5MaXN0IGFzIHN0cmluZ1tdO1xyXG5cclxuICAgICAgICBsZXQgdHlwaW5ncyA9IFRzVHlwZUluZm8uY3JlYXRlRmlsZSgpO1xyXG5cclxuICAgICAgICB0eXBpbmdzLmFkZENsYXNzZXMoe1xyXG4gICAgICAgICAgICBuYW1lOiAnU3R5bGVzJyxcclxuICAgICAgICAgICAgaXNFeHBvcnRlZDogdHJ1ZSxcclxuICAgICAgICAgICAgaXNEZWZhdWx0RXhwb3J0T2ZGaWxlOiB0cnVlLFxyXG4gICAgICAgICAgICBpc0FtYmllbnQ6IHRydWUsXHJcbiAgICAgICAgICAgIGlzTmFtZWRFeHBvcnRPZkZpbGU6IHRydWUsXHJcbiAgICAgICAgICAgIGhhc0RlY2xhcmVLZXl3b3JkOiB0cnVlLFxyXG4gICAgICAgICAgICBwcm9wZXJ0aWVzOiB0b2tlbnMubWFwPFRzVHlwZUluZm8uQ2xhc3NQcm9wZXJ0eVN0cnVjdHVyZT4odG9rZW4gPT4gKHsgbmFtZTogYCcke3Rva2VufSdgLCB0eXBlOiAnc3RyaW5nJyB9KSksXHJcbiAgICAgICAgICAgIG9uQWZ0ZXJXcml0ZTogd3JpdGVyID0+IHtcclxuICAgICAgICAgICAgICAgIHdyaXRlci53cml0ZUxpbmUoYGApO1xyXG4gICAgICAgICAgICAgICAgd3JpdGVyLndyaXRlTGluZShgZXhwb3J0IGRlY2xhcmUgdmFyIHN0eWxlOiBTdHlsZXM7YCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgZnMud3JpdGVGaWxlU3luYyhkZXN0RmlsZU5hbWUsIHR5cGluZ3Mud3JpdGUoKSk7XHJcbiAgICB9XHJcbiAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XHJcbiAgICAgICAgdGhyb3cgZTtcclxuICAgIH1cclxuICAgIGZpbmFsbHkge1xyXG4gICAgICAgIHRtcEZpbGUucmVtb3ZlQ2FsbGJhY2soKTtcclxuICAgIH1cclxufVxyXG5cclxucHJvZ3JhbVxyXG4gICAgLnZlcnNpb24oJzEuMC4wJylcclxuICAgIC5vcHRpb24oJy1kLCAtLWRpciBbcm9vdF0nLCAnc2V0IHJvb3QgZGlyZWN0b3J5JylcclxuICAgIC5vcHRpb24oJy1tLCAtLW1hdGNoIFtyZWdleF0nLCAnc2V0IGZpbGVzIHJlZ2V4JywgJ15bXl9dLitcXFxcLnNjc3MkJylcclxuICAgIC5vcHRpb24oJy13LCAtLXdhdGNoJywgJ3dhdGNoIG1vZGUnKVxyXG4gICAgLnBhcnNlKHByb2Nlc3MuYXJndik7XHJcblxyXG5sZXQgd29ya2luZ0RpcmVjdG9yeSA9IHBhdGhVdGlscy5qb2luKHByb2Nlc3MuY3dkKCksIHByb2dyYW1bJ2RpciddIHx8ICcnKTtcclxubGV0IG1hdGNoID0gbmV3IFJlZ0V4cChwcm9ncmFtWydtYXRjaCddKTtcclxubGV0IGZpbGVzOiBzdHJpbmdbXSA9IGZpbmQuZmlsZVN5bmMobWF0Y2gsIHdvcmtpbmdEaXJlY3RvcnkpO1xyXG5cclxuZmlsZXMucmVkdWNlPFByb21pc2U8dm9pZD4+KChwcmV2aW91cywgY3VycmVudCkgPT4gcHJldmlvdXMudGhlbigoKSA9PiBwcm9jZXNzRmlsZShjdXJyZW50KSkuY2F0Y2goZSA9PiB7IH0pLCBQcm9taXNlLnJlc29sdmUoKSlcclxuICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICBjb25zb2xlLmxvZygnY29tcGxldGVkJyk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKGUgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XHJcbiAgICAgICAgdGhyb3cgZTtcclxuICAgIH0pXHJcbiAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgaWYgKHByb2dyYW1bJ3dhdGNoJ10pIHtcclxuICAgICAgICAgICAgbGV0IHdhdGNoZXIgPSBjaG9raWRhci53YXRjaCgnKicsIHsgY3dkOiB3b3JraW5nRGlyZWN0b3J5IH0pO1xyXG5cclxuICAgICAgICAgICAgd2F0Y2hlclxyXG4gICAgICAgICAgICAgICAgLm9uKCdhZGQnLCBwYXRoID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobWF0Y2gudGVzdChwYXRoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzRmlsZShwYXRoVXRpbHMuam9pbih3b3JraW5nRGlyZWN0b3J5LCBwYXRoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5vbignY2hhbmdlJywgcGF0aCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1hdGNoLnRlc3QocGF0aCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc0ZpbGUocGF0aFV0aWxzLmpvaW4od29ya2luZ0RpcmVjdG9yeSwgcGF0aCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAub24oJ3VubGluaycsIHBhdGggPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChtYXRjaC50ZXN0KHBhdGgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkZXN0RmlsZU5hbWUgPSBnZXREZXN0RmlsZU5hbWUocGF0aFV0aWxzLmpvaW4od29ya2luZ0RpcmVjdG9yeSwgcGF0aCkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZzLmV4aXN0c1N5bmMoZGVzdEZpbGVOYW1lKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZnMudW5saW5rU3luYyhkZXN0RmlsZU5hbWUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGxldCB3YXRjaGVkID0gd2F0Y2hlci5nZXRXYXRjaGVkKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7Il19